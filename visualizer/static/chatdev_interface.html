<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatDev - AIåä½œå¼€å‘å¹³å°</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/marked/marked.min.js"></script>
    <script src="https://unpkg.com/dompurify@2.4.0/dist/purify.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .animate-spin { animation: spin 1s linear infinite; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        /* Markdownæ ·å¼ */
        .markdown-content {
            font-size: 14px;
            line-height: 1.6;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3, 
        .markdown-content h4, .markdown-content h5, .markdown-content h6 {
            font-weight: 600;
            margin: 12px 0 8px 0;
            color: #1f2937;
        }
        .markdown-content h1 { font-size: 18px; }
        .markdown-content h2 { font-size: 16px; }
        .markdown-content h3 { font-size: 15px; }
        .markdown-content h4, .markdown-content h5, .markdown-content h6 { font-size: 14px; }
        
        .markdown-content p {
            margin: 8px 0;
            color: #374151;
        }
        
        .markdown-content ul, .markdown-content ol {
            margin: 8px 0;
            padding-left: 20px;
        }
        .markdown-content li {
            margin: 4px 0;
            color: #374151;
        }
        
        .markdown-content blockquote {
            border-left: 4px solid #e5e7eb;
            margin: 12px 0;
            padding: 8px 12px;
            background-color: #f9fafb;
            color: #6b7280;
            font-style: italic;
        }
        
        .markdown-content code {
            background-color: #f3f4f6;
            color: #dc2626;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
        }
        
        .markdown-content pre {
            background-color: #1f2937;
            color: #f9fafb;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            line-height: 1.5;
        }
        .markdown-content pre code {
            background: none;
            color: inherit;
            padding: 0;
        }
        
        .markdown-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 12px 0;
            font-size: 13px;
        }
        .markdown-content th, .markdown-content td {
            border: 1px solid #e5e7eb;
            padding: 8px 12px;
            text-align: left;
        }
        .markdown-content th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        
        .markdown-content a {
            color: #3b82f6;
            text-decoration: underline;
        }
        .markdown-content a:hover {
            color: #1d4ed8;
        }
        
        .markdown-content strong {
            font-weight: 600;
            color: #1f2937;
        }
        
        .markdown-content em {
            font-style: italic;
        }
        
        .markdown-content hr {
            border: none;
            border-top: 1px solid #e5e7eb;
            margin: 16px 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // å›¾æ ‡ç»„ä»¶
        const Send = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22,2 15,22 11,13 2,9"></polygon>
            </svg>
        );

        const Play = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="5,3 19,12 5,21"></polygon>
            </svg>
        );

        const Users = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );

        const MessageSquare = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
        );

        const Settings = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1m11-7a4 4 0 0 1 0 8 4 4 0 0 1 0-8z"></path>
            </svg>
        );

        const RefreshCw = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23,4 23,10 17,10"></polyline>
                <polyline points="1,20 1,14 7,14"></polyline>
                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
            </svg>
        );

        const Trash2 = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const Code = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="16,18 22,12 16,6"></polyline>
                <polyline points="8,6 2,12 8,18"></polyline>
            </svg>
        );

        const Rocket = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path>
                <path d="M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"></path>
                <path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"></path>
                <path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"></path>
            </svg>
        );

        const ArrowDown = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M7 13l3 3 3-3"></path>
                <path d="M7 6l3 3 3-3"></path>
            </svg>
        );

        const Copy = () => (
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        );

        // Markdownæ¸²æŸ“ç»„ä»¶
        const MarkdownMessage = ({ content }) => {
            const [copied, setCopied] = useState(false);

            // é…ç½®markedé€‰é¡¹
            const markedOptions = {
                breaks: true,
                gfm: true,
                sanitizer: DOMPurify.sanitize,
                highlight: function(code, lang) {
                    // ç®€å•çš„ä»£ç é«˜äº®å¤„ç†
                    return code;
                }
            };

            // æ¸²æŸ“markdownå†…å®¹
            const renderMarkdown = (text) => {
                try {
                    const rawHtml = marked.parse(text, markedOptions);
                    const cleanHtml = DOMPurify.sanitize(rawHtml);
                    return { __html: cleanHtml };
                } catch (error) {
                    console.error('Markdown parsing error:', error);
                    // å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›çº¯æ–‡æœ¬
                    return { __html: DOMPurify.sanitize(text.replace(/\n/g, '<br>')) };
                }
            };

            const copyToClipboard = async () => {
                try {
                    await navigator.clipboard.writeText(content);
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                }
            };

            return (
                <div className="bg-gray-50 rounded-xl p-3 relative group">
                    <button
                        onClick={copyToClipboard}
                        className="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-white hover:bg-gray-100 rounded p-1 shadow-sm border border-gray-200"
                        title={copied ? "å·²å¤åˆ¶!" : "å¤åˆ¶å†…å®¹"}
                    >
                        {copied ? (
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="text-green-600">
                                <polyline points="20,6 9,17 4,12"></polyline>
                            </svg>
                        ) : (
                            <Copy />
                        )}
                    </button>
                    <div 
                        className="markdown-content"
                        dangerouslySetInnerHTML={renderMarkdown(content)}
                    />
                </div>
            );
        };

        function ChatDevInterface() {
            const [messages, setMessages] = useState([]);
            const [newRole, setNewRole] = useState('');
            const [newMessage, setNewMessage] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            
            // æ–°å¢ï¼šä»»åŠ¡ç›¸å…³çŠ¶æ€
            const [taskDescription, setTaskDescription] = useState('');
            const [projectName, setProjectName] = useState('');
            const [taskStatus, setTaskStatus] = useState({ running: false, current_task: null, progress: '' });
            const [isSubmittingTask, setIsSubmittingTask] = useState(false);
            
            // æ–°å¢ï¼šæ»šåŠ¨æ§åˆ¶ç›¸å…³çŠ¶æ€
            const [autoScroll, setAutoScroll] = useState(true);
            const [prevMessageCount, setPrevMessageCount] = useState(0);
            
            const messagesEndRef = useRef(null);
            const messagesContainerRef = useRef(null);

            const scrollToBottom = () => {
                if (autoScroll) {
                    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
                }
            };

            // æ£€æµ‹ç”¨æˆ·æ˜¯å¦æ‰‹åŠ¨æ»šåŠ¨
            const handleScroll = () => {
                if (messagesContainerRef.current) {
                    const { scrollTop, scrollHeight, clientHeight } = messagesContainerRef.current;
                    const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10; // 10pxå®¹å·®
                    
                    // å¦‚æœç”¨æˆ·æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œå¯ç”¨è‡ªåŠ¨æ»šåŠ¨ï¼›å¦åˆ™ç¦ç”¨
                    setAutoScroll(isAtBottom);
                }
            };

            // åªåœ¨æœ‰æ–°æ¶ˆæ¯ä¸”å¯ç”¨è‡ªåŠ¨æ»šåŠ¨æ—¶æ‰æ»šåŠ¨
            useEffect(() => {
                if (messages.length > prevMessageCount && autoScroll) {
                    scrollToBottom();
                }
                setPrevMessageCount(messages.length);
            }, [messages]);

            useEffect(() => {
                fetchMessages();
                fetchTaskStatus();
                const interval = setInterval(() => {
                    fetchMessages();
                    fetchTaskStatus();
                }, 2000);
                return () => clearInterval(interval);
            }, []);

            const fetchMessages = async () => {
                try {
                    const response = await fetch('/get_messages');
                    const data = await response.json();
                    setMessages(data);
                } catch (error) {
                    console.error('è·å–æ¶ˆæ¯å¤±è´¥:', error);
                }
            };

            const fetchTaskStatus = async () => {
                try {
                    const response = await fetch('/task_status');
                    const data = await response.json();
                    setTaskStatus(data);
                } catch (error) {
                    console.error('è·å–ä»»åŠ¡çŠ¶æ€å¤±è´¥:', error);
                }
            };

            const sendMessage = async () => {
                if (!newRole.trim() || !newMessage.trim()) return;

                setIsLoading(true);
                try {
                    const response = await fetch('/send_message', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            role: newRole,
                            text: newMessage,
                        }),
                    });

                    if (response.ok) {
                        setNewRole('');
                        setNewMessage('');
                        fetchMessages();
                    }
                } catch (error) {
                    console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            // æ–°å¢ï¼šå¯åŠ¨ChatDevä»»åŠ¡
            const startTask = async () => {
                if (!taskDescription.trim() || !projectName.trim()) return;

                setIsSubmittingTask(true);
                try {
                    const response = await fetch('/start_task', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            task: taskDescription,
                            name: projectName,
                        }),
                    });

                    if (response.ok) {
                        setTaskDescription('');
                        setProjectName('');
                        fetchTaskStatus();
                    } else {
                        const errorData = await response.json();
                        alert(errorData.error || 'å¯åŠ¨ä»»åŠ¡å¤±è´¥');
                    }
                } catch (error) {
                    console.error('å¯åŠ¨ä»»åŠ¡å¤±è´¥:', error);
                    alert('å¯åŠ¨ä»»åŠ¡å¤±è´¥ï¼š' + error.message);
                } finally {
                    setIsSubmittingTask(false);
                }
            };

            // æ–°å¢ï¼šæ¸…ç©ºæ¶ˆæ¯
            const clearMessages = async () => {
                try {
                    await fetch('/clear_messages', { method: 'POST' });
                    fetchMessages();
                } catch (error) {
                    console.error('æ¸…ç©ºæ¶ˆæ¯å¤±è´¥:', error);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };

            const roleColors = {
                'CEO': 'bg-purple-500',
                'CTO': 'bg-blue-500',
                'Programmer': 'bg-green-500',
                'Code Reviewer': 'bg-orange-500',
                'Tester': 'bg-red-500',
                'Chief Human Resource Officer': 'bg-pink-500',
                'Counselor': 'bg-indigo-500',
                'Chief Creative Officer': 'bg-yellow-500',
                'System': 'bg-gray-700',
                'Default': 'bg-gray-500'
            };

            const getAvatarBg = (role) => {
                return roleColors[role] || roleColors['Default'];
            };

            // ç¤ºä¾‹ä»»åŠ¡
            const exampleTasks = [
                { name: "è´ªåƒè›‡æ¸¸æˆ", description: "åˆ›å»ºä¸€ä¸ªç»å…¸çš„è´ªåƒè›‡æ¸¸æˆï¼ŒåŒ…å«è®¡åˆ†ç³»ç»Ÿå’Œæ¸¸æˆç»“æŸæ£€æµ‹" },
                { name: "å¾…åŠäº‹é¡¹åº”ç”¨", description: "å¼€å‘ä¸€ä¸ªç®€å•çš„å¾…åŠäº‹é¡¹ç®¡ç†åº”ç”¨ï¼Œæ”¯æŒæ·»åŠ ã€åˆ é™¤å’Œæ ‡è®°å®Œæˆä»»åŠ¡" },
                { name: "è®¡ç®—å™¨åº”ç”¨", description: "åˆ¶ä½œä¸€ä¸ªå…·æœ‰åŸºæœ¬è¿ç®—åŠŸèƒ½çš„è®¡ç®—å™¨ï¼Œæ”¯æŒåŠ å‡ä¹˜é™¤è¿ç®—" },
                { name: "å¤©æ°”æŸ¥è¯¢å·¥å…·", description: "å¼€å‘ä¸€ä¸ªå¤©æ°”æŸ¥è¯¢åº”ç”¨ï¼Œèƒ½å¤Ÿæ˜¾ç¤ºå½“å‰å¤©æ°”å’Œæœªæ¥å‡ å¤©çš„å¤©æ°”é¢„æŠ¥" }
            ];

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
                    {/* Header */}
                    <div className="bg-white shadow-sm border-b border-gray-200">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-xl flex items-center justify-center">
                                        <Code />
                                    </div>
                                    <div>
                                        <h1 className="text-xl font-bold text-gray-800">ChatDev Studio</h1>
                                        <p className="text-sm text-gray-600">AI åä½œå¼€å‘å¹³å°</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2">
                                    {taskStatus.running && (
                                        <div className="flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg">
                                            <div className="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
                                            <span className="text-sm font-medium">å¼€å‘ä¸­</span>
                                        </div>
                                    )}
                                    <button
                                        onClick={clearMessages}
                                        className="flex items-center gap-2 px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
                                    >
                                        <Trash2 />
                                        <span className="text-sm">æ¸…ç©º</span>
                                    </button>
                                    <button
                                        onClick={fetchMessages}
                                        className="flex items-center gap-2 px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
                                    >
                                        <RefreshCw />
                                        <span className="text-sm">åˆ·æ–°</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 py-6">
                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            {/* é¡¹ç›®éœ€æ±‚é¢æ¿ */}
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 mb-6">
                                    <div className="flex items-center gap-2 mb-4">
                                        <Rocket />
                                        <h3 className="font-semibold text-gray-800">å¯åŠ¨æ–°é¡¹ç›®</h3>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                é¡¹ç›®åç§°
                                            </label>
                                            <input
                                                type="text"
                                                value={projectName}
                                                onChange={(e) => setProjectName(e.target.value)}
                                                placeholder="å¦‚ï¼šè´ªåƒè›‡æ¸¸æˆ"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm"
                                                disabled={taskStatus.running}
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                éœ€æ±‚æè¿°
                                            </label>
                                            <textarea
                                                value={taskDescription}
                                                onChange={(e) => setTaskDescription(e.target.value)}
                                                placeholder="è¯¦ç»†æè¿°ä½ æƒ³è¦å¼€å‘çš„é¡¹ç›®..."
                                                rows={4}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none text-sm"
                                                disabled={taskStatus.running}
                                            />
                                        </div>
                                        
                                        <button
                                            onClick={startTask}
                                            disabled={!taskDescription.trim() || !projectName.trim() || isSubmittingTask || taskStatus.running}
                                            className="w-full bg-gradient-to-r from-purple-500 to-blue-500 text-white py-3 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-lg transition-all duration-200 flex items-center justify-center gap-2"
                                        >
                                            {isSubmittingTask || taskStatus.running ? (
                                                <>
                                                    <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" />
                                                    {taskStatus.running ? 'å¼€å‘ä¸­...' : 'å¯åŠ¨ä¸­...'}
                                                </>
                                            ) : (
                                                <>
                                                    <Play />
                                                    å¼€å§‹å¼€å‘
                                                </>
                                            )}
                                        </button>

                                        {taskStatus.running && (
                                            <div className="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                                <div className="text-sm font-medium text-blue-800 mb-1">
                                                    å½“å‰ä»»åŠ¡
                                                </div>
                                                <div className="text-xs text-blue-600 mb-2">
                                                    {taskStatus.current_task}
                                                </div>
                                                <div className="text-xs text-blue-600">
                                                    çŠ¶æ€: {taskStatus.progress}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* ç¤ºä¾‹ä»»åŠ¡ */}
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                                    <div className="flex items-center gap-2 mb-4">
                                        <Settings />
                                        <h3 className="font-semibold text-gray-800">ç¤ºä¾‹é¡¹ç›®</h3>
                                    </div>
                                    
                                    <div className="space-y-2">
                                        {exampleTasks.map((task, index) => (
                                            <button
                                                key={index}
                                                onClick={() => {
                                                    setProjectName(task.name);
                                                    setTaskDescription(task.description);
                                                }}
                                                disabled={taskStatus.running}
                                                className="w-full text-left p-3 text-xs bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                <div className="font-medium text-gray-800 mb-1">
                                                    {task.name}
                                                </div>
                                                <div className="text-gray-600 line-clamp-2">
                                                    {task.description}
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* æ¶ˆæ¯åˆ—è¡¨ */}
                            <div className="lg:col-span-2">
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-200 h-96 lg:h-[700px] flex flex-col">
                                    <div className="p-4 border-b border-gray-200">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-2">
                                                <MessageSquare />
                                                <h2 className="font-semibold text-gray-800">å¼€å‘è¿›ç¨‹</h2>
                                                <div className="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full">
                                                    {messages.length} æ¡æ¶ˆæ¯
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <button
                                                    onClick={() => setAutoScroll(!autoScroll)}
                                                    className={`text-xs px-2 py-1 rounded transition-colors ${
                                                        autoScroll 
                                                            ? 'bg-blue-100 text-blue-700' 
                                                            : 'bg-gray-100 text-gray-600'
                                                    }`}
                                                >
                                                    {autoScroll ? 'è‡ªåŠ¨æ»šåŠ¨: å¼€' : 'è‡ªåŠ¨æ»šåŠ¨: å…³'}
                                                </button>
                                                {!autoScroll && (
                                                    <button
                                                        onClick={() => {
                                                            setAutoScroll(true);
                                                            scrollToBottom();
                                                        }}
                                                        className="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition-colors flex items-center gap-1"
                                                    >
                                                        <ArrowDown />
                                                        åˆ°åº•éƒ¨
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div 
                                        ref={messagesContainerRef}
                                        className="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-hide"
                                        onScroll={handleScroll}
                                    >
                                        {messages.length === 0 ? (
                                            <div className="flex items-center justify-center h-full text-gray-500">
                                                <div className="text-center">
                                                    <MessageSquare className="mx-auto mb-2 w-8 h-8" />
                                                    <p>å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®æ¥æŸ¥çœ‹å¼€å‘è¿›ç¨‹</p>
                                                </div>
                                            </div>
                                        ) : (
                                            messages.map((message, index) => (
                                                <div key={index} className="flex gap-3">
                                                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center text-white font-semibold text-sm ${getAvatarBg(message.role)} flex-shrink-0`}>
                                                        {message.role === 'System' ? 'ğŸ¤–' : message.role.charAt(0).toUpperCase()}
                                                    </div>
                                                    <div className="flex-1 min-w-0">
                                                        <div className="flex items-center gap-2 mb-1">
                                                            <span className="font-medium text-gray-800 text-sm">{message.role}</span>
                                                            <span className="text-xs text-gray-500">åˆšåˆš</span>
                                                        </div>
                                                        <MarkdownMessage content={message.text} />
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                        <div ref={messagesEndRef} />
                                    </div>
                                </div>
                            </div>

                            {/* æ‰‹åŠ¨æ¶ˆæ¯å‘é€é¢æ¿ */}
                            <div className="lg:col-span-1 space-y-6">
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                                    <div className="flex items-center gap-2 mb-4">
                                        <Send />
                                        <h3 className="font-semibold text-gray-800">æ‰‹åŠ¨å‚ä¸</h3>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                è§’è‰²èº«ä»½
                                            </label>
                                            <input
                                                type="text"
                                                value={newRole}
                                                onChange={(e) => setNewRole(e.target.value)}
                                                placeholder="å¦‚: CEO, Programmer"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                æ¶ˆæ¯å†…å®¹
                                            </label>
                                            <textarea
                                                value={newMessage}
                                                onChange={(e) => setNewMessage(e.target.value)}
                                                onKeyPress={handleKeyPress}
                                                placeholder="è¾“å…¥ä½ çš„å»ºè®®æˆ–æƒ³æ³•..."
                                                rows={3}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none text-sm"
                                            />
                                        </div>
                                        
                                        <button
                                            onClick={sendMessage}
                                            disabled={!newRole.trim() || !newMessage.trim() || isLoading}
                                            className="w-full bg-gray-600 text-white py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-all duration-200 flex items-center justify-center gap-2 text-sm"
                                        >
                                            {isLoading ? (
                                                <>
                                                    <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" />
                                                    å‘é€ä¸­...
                                                </>
                                            ) : (
                                                <>
                                                    <Send />
                                                    å‘é€æ¶ˆæ¯
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </div>

                                {/* å¿«é€Ÿè§’è‰²é€‰æ‹© */}
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                                    <div className="flex items-center gap-2 mb-4">
                                        <Users />
                                        <h3 className="font-semibold text-gray-800">å¿«é€Ÿè§’è‰²</h3>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 gap-2">
                                        {Object.keys(roleColors).filter(role => role !== 'Default' && role !== 'System').map((role) => (
                                            <button
                                                key={role}
                                                onClick={() => setNewRole(role)}
                                                className="text-left p-2 text-xs bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200"
                                            >
                                                <div className="flex items-center gap-2">
                                                    <div className={`w-3 h-3 rounded-full ${roleColors[role]}`} />
                                                    <span className="text-gray-700 font-medium">{role}</span>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<ChatDevInterface />, document.getElementById('root'));
    </script>
</body>
</html>
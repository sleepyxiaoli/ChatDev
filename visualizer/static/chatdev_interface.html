<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatDev - AIÂçè‰ΩúÂºÄÂèëÂπ≥Âè∞</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/marked/marked.min.js"></script>
    <script src="https://unpkg.com/dompurify@2.4.0/dist/purify.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .animate-spin { animation: spin 1s linear infinite; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        /* ÊâìÂ≠óÊú∫ÊïàÊûú */
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #3b82f6;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Â§¥ÂÉèÊ†∑Âºè */
        .avatar-emoji {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* MarkdownÊ†∑Âºè */
        .markdown-content {
            font-size: 14px;
            line-height: 1.6;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3, 
        .markdown-content h4, .markdown-content h5, .markdown-content h6 {
            font-weight: 600;
            margin: 12px 0 8px 0;
            color: #1f2937;
        }
        .markdown-content h1 { font-size: 18px; }
        .markdown-content h2 { font-size: 16px; }
        .markdown-content h3 { font-size: 15px; }
        .markdown-content h4, .markdown-content h5, .markdown-content h6 { font-size: 14px; }
        
        .markdown-content p {
            margin: 8px 0;
            color: #374151;
        }
        
        .markdown-content ul, .markdown-content ol {
            margin: 8px 0;
            padding-left: 20px;
        }
        .markdown-content li {
            margin: 4px 0;
            color: #374151;
        }
        
        .markdown-content blockquote {
            border-left: 4px solid #e5e7eb;
            margin: 12px 0;
            padding: 8px 12px;
            background-color: #f9fafb;
            color: #6b7280;
            font-style: italic;
        }
        
        .markdown-content code {
            background-color: #f3f4f6;
            color: #dc2626;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
        }
        
        .markdown-content pre {
            background-color: #1f2937;
            color: #f9fafb;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            line-height: 1.5;
        }
        .markdown-content pre code {
            background: none;
            color: inherit;
            padding: 0;
        }
        
        .markdown-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 12px 0;
            font-size: 13px;
        }
        .markdown-content th, .markdown-content td {
            border: 1px solid #e5e7eb;
            padding: 8px 12px;
            text-align: left;
        }
        .markdown-content th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        
        .markdown-content a {
            color: #3b82f6;
            text-decoration: underline;
        }
        .markdown-content a:hover {
            color: #1d4ed8;
        }
        
        .markdown-content strong {
            font-weight: 600;
            color: #1f2937;
        }
        
        .markdown-content em {
            font-style: italic;
        }
        
        .markdown-content hr {
            border: none;
            border-top: 1px solid #e5e7eb;
            margin: 16px 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // ÂõæÊ†áÁªÑ‰ª∂
        const Send = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22,2 15,22 11,13 2,9"></polygon>
            </svg>
        );

        const Play = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="5,3 19,12 5,21"></polygon>
            </svg>
        );

        const Users = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );

        const MessageSquare = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
        );

        const Settings = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1m11-7a4 4 0 0 1 0 8 4 4 0 0 1 0-8z"></path>
            </svg>
        );

        const RefreshCw = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23,4 23,10 17,10"></polyline>
                <polyline points="1,20 1,14 7,14"></polyline>
                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
            </svg>
        );

        const Trash2 = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const Code = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="16,18 22,12 16,6"></polyline>
                <polyline points="8,6 2,12 8,18"></polyline>
            </svg>
        );

        const Rocket = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path>
                <path d="M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"></path>
                <path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"></path>
                <path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"></path>
            </svg>
        );

        const ArrowDown = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M7 13l3 3 3-3"></path>
                <path d="M7 6l3 3 3-3"></path>
            </svg>
        );

        const Copy = () => (
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        );

        // Â§¥ÂÉèÁªÑ‰ª∂ - ‰ΩøÁî®emoji
        const RoleAvatar = ({ role }) => {
            // ËßíËâ≤Âà∞emojiÁöÑÊò†Â∞Ñ
            const roleToEmoji = {
                'CEO': 'üëë',
                'Chief Executive Officer': 'üëë',
                'CTO': 'üíª', 
                'Chief Technology Officer': 'üíª',
                'Programmer': 'üë®‚Äçüíª',
                'Code Reviewer': 'üîç',
                'Tester': 'üß™',
                'Software Test Engineer': 'üß™',
                'Chief Human Resource Officer': 'üë•',
                'Counselor': 'üß†',
                'Chief Creative Officer': 'üé®',
                'Chief Product Officer': 'üì¶',
                'System': 'ü§ñ',
                'User': 'üë§',
                'Prompt Engineer': '‚ö°',
                'Default': 'üë§'
            };

            // ËßíËâ≤È¢úËâ≤ÈÖçÁΩÆ
            const roleColors = {
                'CEO': 'from-purple-500 to-purple-600',
                'Chief Executive Officer': 'from-purple-500 to-purple-600',
                'CTO': 'from-blue-500 to-blue-600',
                'Chief Technology Officer': 'from-blue-500 to-blue-600',
                'Programmer': 'from-green-500 to-green-600',
                'Code Reviewer': 'from-orange-500 to-orange-600',
                'Tester': 'from-red-500 to-red-600',
                'Software Test Engineer': 'from-red-500 to-red-600',
                'Chief Human Resource Officer': 'from-pink-500 to-pink-600',
                'Counselor': 'from-indigo-500 to-indigo-600',
                'Chief Creative Officer': 'from-yellow-500 to-yellow-600',
                'Chief Product Officer': 'from-cyan-500 to-cyan-600',
                'System': 'from-gray-600 to-gray-700',
                'User': 'from-slate-500 to-slate-600',
                'Prompt Engineer': 'from-emerald-500 to-emerald-600',
                'Default': 'from-gray-500 to-gray-600'
            };

            const getEmoji = (role) => {
                return roleToEmoji[role] || roleToEmoji['Default'];
            };

            const getGradient = (role) => {
                return roleColors[role] || roleColors['Default'];
            };

            return (
                <div className={`avatar-emoji bg-gradient-to-br ${getGradient(role)}`}>
                    {getEmoji(role)}
                </div>
            );
        };

        // ÊµÅÂºèÊ∂àÊÅØÁªÑ‰ª∂
        const StreamingMessage = ({ content, isStreaming = false }) => {
            const [copied, setCopied] = useState(false);

            // ÈÖçÁΩÆmarkedÈÄâÈ°π
            const markedOptions = {
                breaks: true,
                gfm: true,
                sanitizer: DOMPurify.sanitize,
                highlight: function(code, lang) {
                    return code;
                }
            };

            // Ê∏≤ÊüìmarkdownÂÜÖÂÆπ
            const renderMarkdown = (text) => {
                try {
                    const rawHtml = marked.parse(text, markedOptions);
                    const cleanHtml = DOMPurify.sanitize(rawHtml);
                    return { __html: cleanHtml };
                } catch (error) {
                    console.error('Markdown parsing error:', error);
                    return { __html: DOMPurify.sanitize(text.replace(/\n/g, '<br>')) };
                }
            };

            const copyToClipboard = async () => {
                try {
                    await navigator.clipboard.writeText(content);
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {
                    console.error('Â§çÂà∂Â§±Ë¥•:', err);
                }
            };

            return (
                <div className="bg-gray-50 rounded-xl p-3 relative group">
                    <button
                        onClick={copyToClipboard}
                        className="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-white hover:bg-gray-100 rounded p-1 shadow-sm border border-gray-200"
                        title={copied ? "Â∑≤Â§çÂà∂!" : "Â§çÂà∂ÂÜÖÂÆπ"}
                    >
                        {copied ? (
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="text-green-600">
                                <polyline points="20,6 9,17 4,12"></polyline>
                            </svg>
                        ) : (
                            <Copy />
                        )}
                    </button>
                    <div 
                        className={`markdown-content ${isStreaming ? 'typing-cursor' : ''}`}
                        dangerouslySetInnerHTML={renderMarkdown(content)}
                    />
                </div>
            );
        };

        function ChatDevInterface() {
            const [messages, setMessages] = useState([]);
            const [newRole, setNewRole] = useState('');
            const [newMessage, setNewMessage] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            
            // ‰ªªÂä°Áõ∏ÂÖ≥Áä∂ÊÄÅ
            const [taskDescription, setTaskDescription] = useState('');
            const [projectName, setProjectName] = useState('');
            const [taskStatus, setTaskStatus] = useState({ running: false, current_task: null, progress: '' });
            const [isSubmittingTask, setIsSubmittingTask] = useState(false);
            
            // ÊªöÂä®ÊéßÂà∂Áõ∏ÂÖ≥Áä∂ÊÄÅ
            const [autoScroll, setAutoScroll] = useState(true);
            const [prevMessageCount, setPrevMessageCount] = useState(0);
            
            // ÊµÅÂºèËæìÂá∫Áõ∏ÂÖ≥Áä∂ÊÄÅ
            const [streamingMessages, setStreamingMessages] = useState(new Map());
            const [eventSource, setEventSource] = useState(null);
            
            const messagesEndRef = useRef(null);
            const messagesContainerRef = useRef(null);

            const scrollToBottom = () => {
                if (autoScroll) {
                    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
                }
            };

            // Ê£ÄÊµãÁî®Êà∑ÊòØÂê¶ÊâãÂä®ÊªöÂä®
            const handleScroll = () => {
                if (messagesContainerRef.current) {
                    const { scrollTop, scrollHeight, clientHeight } = messagesContainerRef.current;
                    const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;
                    setAutoScroll(isAtBottom);
                }
            };

            // ÂàùÂßãÂåñSSEËøûÊé•
            const initializeSSE = useCallback(() => {
                if (eventSource) {
                    eventSource.close();
                }

                const newEventSource = new EventSource('/stream');
                
                newEventSource.onopen = () => {
                    console.log('SSEËøûÊé•Â∑≤Âª∫Á´ã');
                };

                newEventSource.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        
                        if (data.type === 'message_start') {
                            // ÂºÄÂßãÊñ∞Ê∂àÊÅØ
                            setStreamingMessages(prev => new Map(prev.set(data.message_id, {
                                id: data.message_id,
                                role: data.role,
                                content: '',
                                isComplete: false,
                                timestamp: Date.now()
                            })));
                        } else if (data.type === 'message_chunk') {
                            // ËøΩÂä†Ê∂àÊÅØÂÜÖÂÆπ
                            setStreamingMessages(prev => {
                                const newMap = new Map(prev);
                                const message = newMap.get(data.message_id);
                                if (message) {
                                    newMap.set(data.message_id, {
                                        ...message,
                                        content: message.content + data.content
                                    });
                                }
                                return newMap;
                            });
                        } else if (data.type === 'message_complete') {
                            // Ê∂àÊÅØÂÆåÊàê
                            setStreamingMessages(prev => {
                                const newMap = new Map(prev);
                                const message = newMap.get(data.message_id);
                                if (message) {
                                    newMap.set(data.message_id, {
                                        ...message,
                                        isComplete: true
                                    });
                                    
                                    // 3ÁßíÂêéÂ∞ÜÂÆåÊàêÁöÑÊ∂àÊÅØÁßªÂä®Âà∞Ê≠£ÂºèÊ∂àÊÅØÂàóË°®
                                    setTimeout(() => {
                                        setMessages(currentMessages => [...currentMessages, {
                                            role: message.role,
                                            text: message.content
                                        }]);
                                        setStreamingMessages(currentStreaming => {
                                            const newMap = new Map(currentStreaming);
                                            newMap.delete(data.message_id);
                                            return newMap;
                                        });
                                    }, 3000);
                                }
                                return newMap;
                            });
                        } else if (data.type === 'task_status') {
                            // Êõ¥Êñ∞‰ªªÂä°Áä∂ÊÄÅ
                            setTaskStatus(data.status);
                        }
                    } catch (error) {
                        console.error('Ëß£ÊûêSSEÊï∞ÊçÆÂ§±Ë¥•:', error);
                    }
                };

                newEventSource.onerror = (error) => {
                    console.error('SSEËøûÊé•ÈîôËØØ:', error);
                    // 3ÁßíÂêéÈáçÊñ∞ËøûÊé•
                    setTimeout(() => {
                        if (newEventSource.readyState === EventSource.CLOSED) {
                            initializeSSE();
                        }
                    }, 3000);
                };

                setEventSource(newEventSource);
            }, [eventSource]);

            // ÂΩìÊúâÊñ∞Ê∂àÊÅØÊàñÊµÅÂºèÊ∂àÊÅØÊó∂ÊªöÂä®
            useEffect(() => {
                if ((messages.length > prevMessageCount || streamingMessages.size > 0) && autoScroll) {
                    scrollToBottom();
                }
                setPrevMessageCount(messages.length);
            }, [messages, streamingMessages, autoScroll, prevMessageCount]);

            useEffect(() => {
                fetchMessages();
                fetchTaskStatus();
                initializeSSE();
                
                // ÂÆöÊúüÂà∑Êñ∞Ôºà‰Ωú‰∏∫SSEÁöÑÂ§á‰ªΩÔºâ
                const interval = setInterval(() => {
                    fetchMessages();
                    fetchTaskStatus();
                }, 5000);
                
                return () => {
                    clearInterval(interval);
                    if (eventSource) {
                        eventSource.close();
                    }
                };
            }, []);

            const fetchMessages = async () => {
                try {
                    const response = await fetch('/get_messages');
                    const data = await response.json();
                    setMessages(data);
                } catch (error) {
                    console.error('Ëé∑ÂèñÊ∂àÊÅØÂ§±Ë¥•:', error);
                }
            };

            const fetchTaskStatus = async () => {
                try {
                    const response = await fetch('/task_status');
                    const data = await response.json();
                    setTaskStatus(data);
                } catch (error) {
                    console.error('Ëé∑Âèñ‰ªªÂä°Áä∂ÊÄÅÂ§±Ë¥•:', error);
                }
            };

            const sendMessage = async () => {
                if (!newRole.trim() || !newMessage.trim()) return;

                setIsLoading(true);
                try {
                    const response = await fetch('/send_message', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            role: newRole,
                            text: newMessage,
                        }),
                    });

                    if (response.ok) {
                        setNewRole('');
                        setNewMessage('');
                        // ‰∏çÈúÄË¶ÅÁ´ãÂç≥Âà∑Êñ∞ÔºåSSE‰ºöÂ§ÑÁêÜÊñ∞Ê∂àÊÅØ
                    }
                } catch (error) {
                    console.error('ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            const startTask = async () => {
                if (!taskDescription.trim() || !projectName.trim()) return;

                setIsSubmittingTask(true);
                try {
                    const response = await fetch('/start_task', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            task: taskDescription,
                            name: projectName,
                        }),
                    });

                    if (response.ok) {
                        setTaskDescription('');
                        setProjectName('');
                        // SSE‰ºöÂ§ÑÁêÜÁä∂ÊÄÅÊõ¥Êñ∞
                    } else {
                        const errorData = await response.json();
                        alert(errorData.error || 'ÂêØÂä®‰ªªÂä°Â§±Ë¥•');
                    }
                } catch (error) {
                    console.error('ÂêØÂä®‰ªªÂä°Â§±Ë¥•:', error);
                    alert('ÂêØÂä®‰ªªÂä°Â§±Ë¥•Ôºö' + error.message);
                } finally {
                    setIsSubmittingTask(false);
                }
            };

            const clearMessages = async () => {
                try {
                    await fetch('/clear_messages', { method: 'POST' });
                    setMessages([]);
                    setStreamingMessages(new Map());
                } catch (error) {
                    console.error('Ê∏ÖÁ©∫Ê∂àÊÅØÂ§±Ë¥•:', error);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };

            // Á§∫‰æã‰ªªÂä°
            const exampleTasks = [
                { name: "Ë¥™ÂêÉËõáÊ∏∏Êàè", description: "ÂàõÂª∫‰∏Ä‰∏™ÁªèÂÖ∏ÁöÑË¥™ÂêÉËõáÊ∏∏ÊàèÔºåÂåÖÂê´ËÆ°ÂàÜÁ≥ªÁªüÂíåÊ∏∏ÊàèÁªìÊùüÊ£ÄÊµã" },
                { name: "ÂæÖÂäû‰∫ãÈ°πÂ∫îÁî®", description: "ÂºÄÂèë‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂæÖÂäû‰∫ãÈ°πÁÆ°ÁêÜÂ∫îÁî®ÔºåÊîØÊåÅÊ∑ªÂä†„ÄÅÂà†Èô§ÂíåÊ†áËÆ∞ÂÆåÊàê‰ªªÂä°" },
                { name: "ËÆ°ÁÆóÂô®Â∫îÁî®", description: "Âà∂‰Ωú‰∏Ä‰∏™ÂÖ∑ÊúâÂü∫Êú¨ËøêÁÆóÂäüËÉΩÁöÑËÆ°ÁÆóÂô®ÔºåÊîØÊåÅÂä†Âáè‰πòÈô§ËøêÁÆó" },
                { name: "Â§©Ê∞îÊü•ËØ¢Â∑•ÂÖ∑", description: "ÂºÄÂèë‰∏Ä‰∏™Â§©Ê∞îÊü•ËØ¢Â∫îÁî®ÔºåËÉΩÂ§üÊòæÁ§∫ÂΩìÂâçÂ§©Ê∞îÂíåÊú™Êù•Âá†Â§©ÁöÑÂ§©Ê∞îÈ¢ÑÊä•" }
            ];

            // ÂêàÂπ∂Ê≠£ÂºèÊ∂àÊÅØÂíåÊµÅÂºèÊ∂àÊÅØÁî®‰∫éÊòæÁ§∫
            const allMessages = [
                ...messages,
                ...Array.from(streamingMessages.values()).sort((a, b) => a.timestamp - b.timestamp)
            ];

            const totalMessageCount = messages.length + streamingMessages.size;

            // Âø´ÈÄüËßíËâ≤ÈÄâÊã©ÂàóË°®Ôºà‰ΩøÁî®ÂÆûÈôÖÁöÑËßíËâ≤ÂêçÁß∞Ôºâ
            const quickRoles = [
                'Programmer',
                'Code Reviewer',
                'Tester',
                'Chief Human Resource Officer',
                'Counselor',
                'Chief Creative Officer',
                'Chief Product Officer',
                'Prompt Engineer'
            ];

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
                    {/* Header */}
                    <div className="bg-white shadow-sm border-b border-gray-200">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-xl flex items-center justify-center">
                                        <Code />
                                    </div>
                                    <div>
                                        <h1 className="text-xl font-bold text-gray-800">ChatDev Studio</h1>
                                        <p className="text-sm text-gray-600">AI Âçè‰ΩúÂºÄÂèëÂπ≥Âè∞ - ÂÆûÊó∂ÊµÅÂºèËæìÂá∫</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2">
                                    {streamingMessages.size > 0 && (
                                        <div className="flex items-center gap-2 px-3 py-2 bg-green-50 text-green-700 rounded-lg">
                                            <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                            <span className="text-sm font-medium">ÂÆûÊó∂ËæìÂá∫‰∏≠</span>
                                        </div>
                                    )}
                                    {taskStatus.running && (
                                        <div className="flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg">
                                            <div className="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
                                            <span className="text-sm font-medium">ÂºÄÂèë‰∏≠</span>
                                        </div>
                                    )}
                                    <button
                                        onClick={clearMessages}
                                        className="flex items-center gap-2 px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
                                    >
                                        <Trash2 />
                                        <span className="text-sm">Ê∏ÖÁ©∫</span>
                                    </button>
                                    <button
                                        onClick={fetchMessages}
                                        className="flex items-center gap-2 px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
                                    >
                                        <RefreshCw />
                                        <span className="text-sm">Âà∑Êñ∞</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 py-6">
                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            {/* È°πÁõÆÈúÄÊ±ÇÈù¢Êùø */}
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 mb-6">
                                    <div className="flex items-center gap-2 mb-4">
                                        <Rocket />
                                        <h3 className="font-semibold text-gray-800">ÂêØÂä®Êñ∞È°πÁõÆ</h3>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                È°πÁõÆÂêçÁß∞
                                            </label>
                                            <input
                                                type="text"
                                                value={projectName}
                                                onChange={(e) => setProjectName(e.target.value)}
                                                placeholder="Â¶ÇÔºöË¥™ÂêÉËõáÊ∏∏Êàè"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm"
                                                disabled={taskStatus.running}
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                ÈúÄÊ±ÇÊèèËø∞
                                            </label>
                                            <textarea
                                                value={taskDescription}
                                                onChange={(e) => setTaskDescription(e.target.value)}
                                                placeholder="ËØ¶ÁªÜÊèèËø∞‰Ω†ÊÉ≥Ë¶ÅÂºÄÂèëÁöÑÈ°πÁõÆ..."
                                                rows={4}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none text-sm"
                                                disabled={taskStatus.running}
                                            />
                                        </div>
                                        
                                        <button
                                            onClick={startTask}
                                            disabled={!taskDescription.trim() || !projectName.trim() || isSubmittingTask || taskStatus.running}
                                            className="w-full bg-gradient-to-r from-purple-500 to-blue-500 text-white py-3 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-lg transition-all duration-200 flex items-center justify-center gap-2"
                                        >
                                            {isSubmittingTask || taskStatus.running ? (
                                                <>
                                                    <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" />
                                                    {taskStatus.running ? 'ÂºÄÂèë‰∏≠...' : 'ÂêØÂä®‰∏≠...'}
                                                </>
                                            ) : (
                                                <>
                                                    <Play />
                                                    ÂºÄÂßãÂºÄÂèë
                                                </>
                                            )}
                                        </button>

                                        {taskStatus.running && (
                                            <div className="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                                <div className="text-sm font-medium text-blue-800 mb-1">
                                                    ÂΩìÂâç‰ªªÂä°
                                                </div>
                                                <div className="text-xs text-blue-600 mb-2">
                                                    {taskStatus.current_task}
                                                </div>
                                                <div className="text-xs text-blue-600">
                                                    Áä∂ÊÄÅ: {taskStatus.progress}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* Á§∫‰æã‰ªªÂä° */}
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                                    <div className="flex items-center gap-2 mb-4">
                                        <Settings />
                                        <h3 className="font-semibold text-gray-800">Á§∫‰æãÈ°πÁõÆ</h3>
                                    </div>
                                    
                                    <div className="space-y-2">
                                        {exampleTasks.map((task, index) => (
                                            <button
                                                key={index}
                                                onClick={() => {
                                                    setProjectName(task.name);
                                                    setTaskDescription(task.description);
                                                }}
                                                disabled={taskStatus.running}
                                                className="w-full text-left p-3 text-xs bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                <div className="font-medium text-gray-800 mb-1">
                                                    {task.name}
                                                </div>
                                                <div className="text-gray-600 line-clamp-2">
                                                    {task.description}
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Ê∂àÊÅØÂàóË°® */}
                            <div className="lg:col-span-2">
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-200 h-96 lg:h-[700px] flex flex-col">
                                    <div className="p-4 border-b border-gray-200">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-2">
                                                <MessageSquare />
                                                <h2 className="font-semibold text-gray-800">ÂºÄÂèëËøõÁ®ã</h2>
                                                <div className="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full">
                                                    {totalMessageCount} Êù°Ê∂àÊÅØ
                                                </div>
                                                {streamingMessages.size > 0 && (
                                                    <div className="bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded-full">
                                                        {streamingMessages.size} Êù°ÂÆûÊó∂
                                                    </div>
                                                )}
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <button
                                                    onClick={() => setAutoScroll(!autoScroll)}
                                                    className={`text-xs px-2 py-1 rounded transition-colors ${
                                                        autoScroll 
                                                            ? 'bg-blue-100 text-blue-700' 
                                                            : 'bg-gray-100 text-gray-600'
                                                    }`}
                                                >
                                                    {autoScroll ? 'Ëá™Âä®ÊªöÂä®: ÂºÄ' : 'Ëá™Âä®ÊªöÂä®: ÂÖ≥'}
                                                </button>
                                                {!autoScroll && (
                                                    <button
                                                        onClick={() => {
                                                            setAutoScroll(true);
                                                            scrollToBottom();
                                                        }}
                                                        className="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition-colors flex items-center gap-1"
                                                    >
                                                        <ArrowDown />
                                                        Âà∞Â∫ïÈÉ®
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div 
                                        ref={messagesContainerRef}
                                        className="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-hide"
                                        onScroll={handleScroll}
                                    >
                                        {allMessages.length === 0 ? (
                                            <div className="flex items-center justify-center h-full text-gray-500">
                                                <div className="text-center">
                                                    <MessageSquare className="mx-auto mb-2 w-8 h-8" />
                                                    <p>ÂºÄÂßã‰∏Ä‰∏™Êñ∞È°πÁõÆÊù•Êü•ÁúãÂºÄÂèëËøõÁ®ã</p>
                                                </div>
                                            </div>
                                        ) : (
                                            allMessages.map((message, index) => (
                                                <div key={message.id || index} className="flex gap-3">
                                                    <RoleAvatar role={message.role} />
                                                    <div className="flex-1 min-w-0">
                                                        <div className="flex items-center gap-2 mb-1">
                                                            <span className="font-medium text-gray-800 text-sm">{message.role}</span>
                                                            <span className="text-xs text-gray-500">
                                                                {message.isComplete === false ? 'ËæìÂÖ•‰∏≠...' : 'ÂàöÂàö'}
                                                            </span>
                                                            {message.isComplete === false && (
                                                                <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                                            )}
                                                        </div>
                                                        <StreamingMessage 
                                                            content={message.text || message.content} 
                                                            isStreaming={message.isComplete === false}
                                                        />
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                        <div ref={messagesEndRef} />
                                    </div>
                                </div>
                            </div>

                            {/* ÊâãÂä®Ê∂àÊÅØÂèëÈÄÅÈù¢Êùø */}
                            <div className="lg:col-span-1 space-y-6">
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                                    <div className="flex items-center gap-2 mb-4">
                                        <Send />
                                        <h3 className="font-semibold text-gray-800">ÊâãÂä®ÂèÇ‰∏é</h3>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                ËßíËâ≤Ë∫´‰ªΩ
                                            </label>
                                            <input
                                                type="text"
                                                value={newRole}
                                                onChange={(e) => setNewRole(e.target.value)}
                                                placeholder="Â¶Ç: CEO, Programmer"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Ê∂àÊÅØÂÜÖÂÆπ
                                            </label>
                                            <textarea
                                                value={newMessage}
                                                onChange={(e) => setNewMessage(e.target.value)}
                                                onKeyPress={handleKeyPress}
                                                placeholder="ËæìÂÖ•‰Ω†ÁöÑÂª∫ËÆÆÊàñÊÉ≥Ê≥ï..."
                                                rows={3}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none text-sm"
                                            />
                                        </div>
                                        
                                        <button
                                            onClick={sendMessage}
                                            disabled={!newRole.trim() || !newMessage.trim() || isLoading}
                                            className="w-full bg-gray-600 text-white py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-all duration-200 flex items-center justify-center gap-2 text-sm"
                                        >
                                            {isLoading ? (
                                                <>
                                                    <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" />
                                                    ÂèëÈÄÅ‰∏≠...
                                                </>
                                            ) : (
                                                <>
                                                    <Send />
                                                    ÂèëÈÄÅÊ∂àÊÅØ
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </div>

                                {/* Âø´ÈÄüËßíËâ≤ÈÄâÊã© */}
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                                    <div className="flex items-center gap-2 mb-4">
                                        <Users />
                                        <h3 className="font-semibold text-gray-800">Âø´ÈÄüËßíËâ≤</h3>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 gap-2">
                                        {quickRoles.map((role) => (
                                            <button
                                                key={role}
                                                onClick={() => setNewRole(role)}
                                                className="text-left p-3 text-xs bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200"
                                            >
                                                <div className="flex items-center gap-3">
                                                    <RoleAvatar role={role} />
                                                    <span className="text-gray-700 font-medium">{role}</span>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<ChatDevInterface />, document.getElementById('root'));
    </script>
</body>
</html>